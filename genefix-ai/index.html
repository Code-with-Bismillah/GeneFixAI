<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <title>GeneFix AI</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center justify-center">
  <header class="w-full bg-blue-700 py-6 mb-8 flex flex-col items-center relative">
    <h1 class="text-4xl font-bold text-center text-white">GeneFix AI</h1>
    <p class="text-center text-blue-100 mt-2">AI-powered Genome Mutation Detection & Correction</p>
    <div id="userProfileBar" class="absolute right-8 top-6 flex items-center gap-3 hidden">
      <div id="navProfileAvatar"></div>
      <span id="userName" class="text-white font-semibold"></span>
      <a href="profile.html" class="text-blue-200 underline text-sm ml-2">Profile</a>
      <button id="logoutBtn" class="ml-2 px-2 py-1 bg-blue-900 text-white rounded text-xs">Logout</button>
    </div>
    <div id="signInBar" class="absolute right-8 top-6 flex items-center gap-3">
      <a href="login.html" class="text-white font-semibold underline">Sign In</a>
    </div>
  </header>
  <main class="w-full max-w-2xl p-8 bg-white rounded-lg shadow-lg flex flex-col items-center">
    <section class="mb-8 text-center">
      <h2 class="text-2xl font-semibold mb-2">Mission</h2>
      <p class="text-gray-600 mb-4">Empowering researchers and clinicians with state-of-the-art AI for genome analysis and CRISPR-based correction.</p>
      <a href="upload.html" class="inline-block bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 transition">Upload Genome / Try Tool</a>
    </section>
    <section class="w-full flex flex-col gap-4 mt-8">
      <a href="mutation_detection_result.html" class="block w-full py-3 px-6 text-center bg-green-600 text-white rounded hover:bg-green-700 transition">Mutation Detection Demo</a>
      <a href="crispr_correction.html" class="block w-full py-3 px-6 text-center bg-purple-600 text-white rounded hover:bg-purple-700 transition">CRISPR Correction Tool</a>
      <a href="/docs" class="block w-full py-3 px-6 text-center bg-gray-700 text-white rounded hover:bg-gray-900 transition">API Playground</a>
      <a href="about.html" class="block w-full py-3 px-6 text-center bg-gray-500 text-white rounded hover:bg-gray-700 transition">About / Docs</a>
      <a href="login.html" class="block w-full py-3 px-6 text-center bg-blue-400 text-white rounded hover:bg-blue-600 transition">Login / Signup</a>
    </section>
    <footer class="mt-8 text-center text-xs text-gray-400">&copy; 2025 GeneFix AI</footer>
  </main>
  <script>
      // Show user profile bar if logged in
      function showUserProfileBar() {
        const userId = localStorage.getItem('user_id');
        const userProfileBar = document.getElementById('userProfileBar');
        const signInBar = document.getElementById('signInBar');
        if (userId) {
          fetch(`/profile/${userId}`)
            .then(res => res.json())
            .then(profile => {
              if (profile && profile.email) {
                userProfileBar.classList.remove('hidden');
                signInBar.classList.add('hidden');
                document.getElementById('userName').textContent = profile.full_name || profile.username || profile.email;
                // If profile_picture is a valid URL or file, use it; otherwise fallback to avatar.png
                let photo = profile.profile_picture && profile.profile_picture !== 'undefined' && profile.profile_picture !== '' ? profile.profile_picture : 'avatar.png';
                // If not a full URL, prepend with local path if needed
                if (photo && !photo.startsWith('http') && !photo.startsWith('/')) {
                  photo = './' + photo;
                }
                document.getElementById('userPhoto').src = photo;
              } else {
                userProfileBar.classList.add('hidden');
                signInBar.classList.remove('hidden');
              }
            });
        } else {
          userProfileBar.classList.add('hidden');
          signInBar.classList.remove('hidden');
        }
      }
      showUserProfileBar();
      // Logout button
      document.getElementById('logoutBtn').onclick = function() {
        localStorage.removeItem('user_id');
        window.location.reload();
      };
      function isImageData(str) {
  return (
    typeof str === 'string' &&
    (str.startsWith('data:image') || str.startsWith('http://') || str.startsWith('https://'))
  );
}
function getProfileAvatarHTML(profile, size = 32) {
  let imgSrc = isImageData(profile.profile_picture) ? profile.profile_picture : '';
  let initials = '';
  if (!imgSrc) {
    if (profile.profile_picture && /^[A-Z]{1,3}$/.test(profile.profile_picture)) {
      initials = profile.profile_picture;
    } else {
      let name = profile.full_name || profile.username || profile.email || '';
      initials = name.split(' ').map(w => w[0]).join('').substring(0,2).toUpperCase();
    }
  }
  return `<div class="rounded-full flex items-center justify-center bg-blue-200 text-blue-800 font-bold border-2 border-blue-400"
              style="width:${size}px;height:${size}px;overflow:hidden;">
    ${imgSrc
      ? `<img src="${imgSrc}" class="w-full h-full object-cover" alt="${profile.full_name || profile.username || profile.email || 'Profile Picture'}"/>`
      : `<span style="font-size:${size/2}px;">${initials}</span>`}
  </div>`;
}
// Example usage for nav/profile bar:
let userId = localStorage.getItem('user_id');
if (userId && document.getElementById('navProfileAvatar')) {
  fetch(`/profile/${userId}`)
    .then(res => res.json())
    .then(profile => {
      document.getElementById('navProfileAvatar').innerHTML = getProfileAvatarHTML(profile, 32);
    });
}
    </script>
</body>
</html>
